# PopFact QA Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        PopFact Extension                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  content.js  â”‚  background.js  â”‚  overlay.css  â”‚  popup.js      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚             â”‚
         â”‚             â”‚ Chrome Extension APIs
         â”‚             â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚             â”‚                                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”
â”‚                     Playwright Test Environment                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              Test Suites (36 tests)                     â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚  overlay-basic.spec.ts       (9 tests)                  â”‚    â”‚
â”‚  â”‚  â”œâ”€ Injection & visibility                              â”‚    â”‚
â”‚  â”‚  â”œâ”€ Toggle functionality                                â”‚    â”‚
â”‚  â”‚  â””â”€ Non-interference checks                             â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚  fact-checking.spec.ts       (9 tests)                  â”‚    â”‚
â”‚  â”‚  â”œâ”€ TRUE verdicts (green âœ“)                             â”‚    â”‚
â”‚  â”‚  â”œâ”€ FALSE verdicts (red âœ—)                              â”‚    â”‚
â”‚  â”‚  â”œâ”€ MIXED verdicts (yellow !)                           â”‚    â”‚
â”‚  â”‚  â””â”€ UNVERIFIED verdicts (gray ?)                        â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚  performance.spec.ts         (8 tests)                  â”‚    â”‚
â”‚  â”‚  â”œâ”€ Time to First Paint < 200ms                         â”‚    â”‚
â”‚  â”‚  â”œâ”€ Animation FPS > 30                                  â”‚    â”‚
â”‚  â”‚  â””â”€ Memory usage < 50MB                                 â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚  anti-fragility.spec.ts      (11 tests)                 â”‚    â”‚
â”‚  â”‚  â”œâ”€ Complex HTML structures                             â”‚    â”‚
â”‚  â”‚  â”œâ”€ Special characters                                  â”‚    â”‚
â”‚  â”‚  â”œâ”€ CSS conflicts                                       â”‚    â”‚
â”‚  â”‚  â””â”€ Error handling                                      â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              Test Utilities                              â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚  network-mocking.ts                                     â”‚    â”‚
â”‚  â”‚  â”œâ”€ mockFactCheckResponse()                             â”‚    â”‚
â”‚  â”‚  â”œâ”€ mockFactCheckResponses()                            â”‚    â”‚
â”‚  â”‚  â””â”€ mockApiEndpoint()                                   â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚  shadow-dom.ts                                          â”‚    â”‚
â”‚  â”‚  â”œâ”€ getOverlay()                                        â”‚    â”‚
â”‚  â”‚  â”œâ”€ getFactItems()                                      â”‚    â”‚
â”‚  â”‚  â”œâ”€ waitForOverlay()                                    â”‚    â”‚
â”‚  â”‚  â””â”€ toggleOverlay()                                     â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚  performance.ts                                         â”‚    â”‚
â”‚  â”‚  â”œâ”€ checkOverlayPerformance()                           â”‚    â”‚
â”‚  â”‚  â”œâ”€ measureTickerFPS()                                  â”‚    â”‚
â”‚  â”‚  â””â”€ measureMemoryImpact()                               â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              Test Fixtures                               â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚  test-page.html                                         â”‚    â”‚
â”‚  â”‚  â”œâ”€ Sample news article                                 â”‚    â”‚
â”‚  â”‚  â”œâ”€ TRUE claims                                         â”‚    â”‚
â”‚  â”‚  â”œâ”€ FALSE claims                                        â”‚    â”‚
â”‚  â”‚  â”œâ”€ MIXED claims                                        â”‚    â”‚
â”‚  â”‚  â””â”€ Dynamic content injection                           â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Chromium Browser  â”‚
                    â”‚    (Headless)      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Test Flow

```
1. Test Starts
   â”‚
   â”œâ”€â†’ Mock API responses (network-mocking.ts)
   â”‚   â””â”€â†’ Intercept chrome.runtime.sendMessage
   â”‚
   â”œâ”€â†’ Navigate to test page
   â”‚   â””â”€â†’ Extension content.js injects overlay
   â”‚
   â”œâ”€â†’ Wait for overlay (shadow-dom.ts)
   â”‚   â””â”€â†’ Use resilient selectors (#popfact-overlay)
   â”‚
   â”œâ”€â†’ Interact with page
   â”‚   â”œâ”€â†’ Toggle overlay
   â”‚   â”œâ”€â†’ Check fact items
   â”‚   â””â”€â†’ Measure performance
   â”‚
   â””â”€â†’ Assert expectations
       â”œâ”€â†’ Element visibility
       â”œâ”€â†’ Correct verdicts/colors
       â”œâ”€â†’ Performance thresholds
       â””â”€â†’ No page interference
```

## Mocking Strategy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Real Extension Flow (Production)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  content.js  â”€â”€â†’  chrome.runtime.sendMessage            â”‚
â”‚                        â”‚                                 â”‚
â”‚                        â–¼                                 â”‚
â”‚                  background.js                           â”‚
â”‚                        â”‚                                 â”‚
â”‚                        â–¼                                 â”‚
â”‚              OpenAI/Claude/Custom API                    â”‚
â”‚                        â”‚                                 â”‚
â”‚                        â–¼                                 â”‚
â”‚              Fact-check response                         â”‚
â”‚                        â”‚                                 â”‚
â”‚                        â–¼                                 â”‚
â”‚    chrome.tabs.sendMessage(result)                      â”‚
â”‚                        â”‚                                 â”‚
â”‚                        â–¼                                 â”‚
â”‚              Display in ticker                           â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               Mocked Flow (Testing)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  content.js  â”€â”€â†’  chrome.runtime.sendMessage            â”‚
â”‚                        â”‚                                 â”‚
â”‚                        â–¼                                 â”‚
â”‚              [INTERCEPTED BY MOCK]                       â”‚
â”‚                        â”‚                                 â”‚
â”‚                        â–¼                                 â”‚
â”‚              Return predefined response                  â”‚
â”‚              {                                           â”‚
â”‚                verdict: 'FALSE',                         â”‚
â”‚                explanation: 'Known hoax',                â”‚
â”‚                confidence: 0.1                           â”‚
â”‚              }                                           â”‚
â”‚                        â”‚                                 â”‚
â”‚                        â–¼                                 â”‚
â”‚              Display in ticker                           â”‚
â”‚                                                          â”‚
â”‚  âœ… No API costs                                         â”‚
â”‚  âœ… Deterministic results                                â”‚
â”‚  âœ… Fast execution                                       â”‚
â”‚  âœ… Works offline                                        â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Performance Guardrails

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Performance Thresholds          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚  Time to First Paint    < 200ms  âš¡  â”‚
â”‚  Animation Frame Rate   > 30 FPS  ğŸ¬ â”‚
â”‚  Memory Footprint       < 50 MB   ğŸ’¾ â”‚
â”‚  Page Interaction       < 100ms   âš™ï¸  â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

If any test exceeds threshold â†’ Test fails âŒ
```

## CI/CD Pipeline

```
GitHub Push/PR
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   GitHub Actions Workflow       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                â”‚
â”‚  1. Checkout code              â”‚
â”‚  2. Setup Node.js 20           â”‚
â”‚  3. Install dependencies       â”‚
â”‚  4. Install Playwright         â”‚
â”‚  5. Run tests                  â”‚
â”‚  6. Upload artifacts           â”‚
â”‚     â”œâ”€ HTML report             â”‚
â”‚     â””â”€ Test results            â”‚
â”‚                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
Test Results Available in Actions Tab
```

## Key Design Principles

1. **No Live API Calls**
   - All external APIs are mocked
   - Tests run fast and reliably
   - No API costs during testing

2. **Resilient Selectors**
   - Use stable IDs: `#popfact-overlay`
   - Semantic classes: `.popfact-item.true`
   - Avoid brittle: `div > div > span`

3. **Performance First**
   - 200ms overlay load budget
   - 30 FPS animation requirement
   - Memory usage monitoring

4. **Anti-Fragility**
   - Tests work with HTML changes
   - Handle edge cases gracefully
   - Recover from errors

5. **Comprehensive Coverage**
   - 36 tests across 4 categories
   - Basic functionality
   - Integration scenarios
   - Performance metrics
   - Edge cases
